// Generated by CoffeeScript 1.10.0
(function() {
  var cheerio, ipspiders, superagent;

  superagent = require('superagent');

  cheerio = require('cheerio');

  ipspiders = function(page) {
    return this.page = page;
  };

  ipspiders.prototype = {
    getData: function(response) {
      return superagent.get(this.page).end(function(err, res) {
        var $, id, iplists;
        if (err) {
          return console.error(err);
        } else {
          iplists = [];
          $ = cheerio.load(res.text);
          console.log("========================^_^======================");
          id = 0;
          $('table tr').each(function(i, elem) {
            var ip;
            ip = $(this).find('td:nth-child(2)').text().trim();
            if (ip) {
              iplists.push({
                id: id,
                ip: ip,
                port: $(this).find('td:nth-child(3)').text().trim(),
                dis: $(this).find('td:nth-child(4)').text().trim(),
                user: $(this).find('td:nth-child(5)').text().trim(),
                type: $(this).find('td:nth-child(6)').text().trim(),
                time: $(this).find('td:nth-child(7)').text().trim()
              });
              return id += 1;
            }
          });
          console.log(iplists);
          console.log("========================^_^======================");
          return response.render('index', {
            title: 'Express',
            ips: iplists
          });
        }
      });
    }
  };

  module.exports = ipspiders;

}).call(this);
